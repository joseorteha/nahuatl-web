<!DOCTYPE html>
<html>
<head>
    <title>Limpiar Service Worker</title>
</head>
<body>
    <h1>Limpiando Service Worker...</h1>
    <div id="status">Procesando...</div>
    
    <script>
        async function clearServiceWorker() {
            const statusDiv = document.getElementById('status');
            
            if ('serviceWorker' in navigator) {
                try {
                    // Obtener todas las registraciones
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    
                    if (registrations.length === 0) {
                        statusDiv.innerHTML = '‚úÖ No hay Service Workers registrados';
                        return;
                    }
                    
                    // Desregistrar todos los Service Workers
                    for (let registration of registrations) {
                        await registration.unregister();
                        console.log('SW desregistrado:', registration);
                    }
                    
                    statusDiv.innerHTML = `‚úÖ ${registrations.length} Service Worker(s) desregistrados correctamente`;
                    
                    // Limpiar cach√©
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(
                            cacheNames.map(cacheName => caches.delete(cacheName))
                        );
                        statusDiv.innerHTML += '<br>‚úÖ Cach√© limpiado';
                    }
                    
                    statusDiv.innerHTML += '<br><br><strong>üîÑ Recarga la p√°gina principal ahora</strong>';
                    
                } catch (error) {
                    statusDiv.innerHTML = '‚ùå Error: ' + error.message;
                    console.error('Error limpiando SW:', error);
                }
            } else {
                statusDiv.innerHTML = '‚ùå Service Workers no soportados';
            }
        }
        
        // Ejecutar autom√°ticamente
        clearServiceWorker();
    </script>
</body>
</html>